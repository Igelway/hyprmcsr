#!/bin/bash

# Standardwerte ggf. aus Environment Ã¼bernehmen
HYPRMCSR_PROFILE="${HYPRMCSR_PROFILE:-}"
PROFILE="${PROFILE:-}"

usage() {
  echo "Usage: $0 [-h HYPRMCSR_PROFILE] [-p PROFILE] <command> [args...]"
  echo "Commands: start, destroy, delete-old-worlds, install, modcheck, run-jar, version"
  exit 1
}

# Version ausgeben, wenn --version oder version als Befehl
if [[ "$1" == "--version" || "$1" == "version" ]]; then
  VERSION_FILE="$(dirname "$(realpath "$0")")/../VERSION"
  if [ -f "$VERSION_FILE" ]; then
    cat "$VERSION_FILE"
  else
    echo "unknown version"
  fi
  exit 0
fi

# Argumente parsen
while [[ "$1" =~ ^- ]]; do
  case "$1" in
    -h)
      shift
      HYPRMCSR_PROFILE="$1"
      ;;
    -p)
      shift
      PROFILE="$1"
      ;;
    *)
      usage
      ;;
  esac
  shift
done

CMD="$1"
shift

if [ -z "$CMD" ]; then
  usage
fi

# Mapping von Kebab-Case zu Skriptname
SCRIPT_NAME=$(echo "$CMD" | tr '-' '_').sh

# Verzeichnis, in dem die eigentlichen Skripte liegen
SCRIPT_DIR="$(dirname "$(realpath "$0")")/../scripts"

SCRIPT_PATH="$SCRIPT_DIR/$SCRIPT_NAME"

if [ ! -f "$SCRIPT_PATH" ]; then
  echo "Unknown command: $CMD"
  usage
fi

# Umgebungsvariablen setzen, falls angegeben
[ -n "$HYPRMCSR_PROFILE" ] && export HYPRMCSR_PROFILE="$HYPRMCSR_PROFILE"
[ -n "$PROFILE" ] && set -- "$PROFILE" "$@"

exec "$SCRIPT_PATH" "$@"
